SELECT
  TABLE_NAME
FROM
  TABS;

-- user_tables, user, all, dba

DESC OS_UDAJE;

SELECT
  MENO,
  PRIEZVISKO,
  POCET
FROM
  (
    SELECT
      MENO,
      PRIEZVISKO,
      ROD_CISLO,
      COUNT(CIS_PREDM) AS POCET
    FROM
      OS_UDAJE
      LEFT JOIN STUDENT
      USING(ROD_CISLO)
      LEFT JOIN ZAP_PREDMETY
      USING(OS_CISLO)
    GROUP BY
      MENO,
      PRIEZVISKO,
      ROD_CISLO
    ORDER BY
      3
  );

-- group by meno, priezvisko, rod_cislo ;

SELECT
  MENO,
  PRIEZVISKO,
  OS_CISLO
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  USING(ROD_CISLO)
WHERE
  PRIEZVISKO='Biely';

SELECT
  MENO,
  PRIEZVISKO,
  ROD_CISLO,
  COUNT(CIS_PREDM) AS POCET
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  USING(ROD_CISLO)
  LEFT JOIN ZAP_PREDMETY
  USING(OS_CISLO)
GROUP BY
  MENO,
  PRIEZVISKO,
  ROD_CISLO
HAVING
  COUNT(CIS_PREDM) = (
    SELECT
      MAX(COUNT(CIS_PREDM))
    FROM
      ZAP_PREDMETY
      JOIN STUDENT
      USING(OS_CISLO)
    GROUP BY
      ROD_CISLO
  );

SELECT
  MENO,
  PRIEZVISKO,
  OS_CISLO
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  USING(ROD_CISLO);

SELECT
  MENO,
  PRIEZVISKO,
  OS_CISLO
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  ON(OS_UDAJE.ROD_CISLO=STUDENT.ROD_CISLO)
ORDER BY
  OS_CISLO NULLS FIRST;

SELECT
  MENO,
  PRIEZVISKO,
  OS_CISLO
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  ON(OS_UDAJE.ROD_CISLO=STUDENT.ROD_CISLO
  AND ROCNIK=2)
ORDER BY
  OS_CISLO NULLS LAST;

SELECT
  MENO,
  PRIEZVISKO,
  OS_CISLO
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  ON(OS_UDAJE.ROD_CISLO=STUDENT.ROD_CISLO)
WHERE
  ROCNIK=2
ORDER BY
  OS_CISLO NULLS LAST;

SELECT
  MENO,
  PRIEZVISKO
FROM
  OS_UDAJE
WHERE
  ROD_CISLO NOT IN (
    SELECT
      ROD_CISLO
    FROM
      STUDENT UNION
      SELECT
        NULL
      FROM
        DUAL
  );

SELECT
  MENO,
  PRIEZVISKO
FROM
  OS_UDAJE
WHERE
  NOT EXISTS(
    SELECT
      'x'
    FROM
      STUDENT
    WHERE
      STUDENT.ROD_CISLO=OS_UDAJE.ROD_CISLO
  );

SELECT
  MENO,
  PRIEZVISKO,
  COUNT(OS_CISLO)
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  USING(ROD_CISLO)
GROUP BY
  MENO,
  PRIEZVISKO,
  ROD_CISLO
HAVING
  COUNT(OS_CISLO)<=2;

SET SERVEROUTPUT ON;

BEGIN
  FOR PREMENNA IN (
    SELECT
      MENO,
      PRIEZVISKO
    FROM
      OS_UDAJE
  ) LOOP
    DBMS_OUTPUT.PUT_LINE(PREMENNA.MENO);
  END LOOP;
END;
/

CREATE USER LOGIN IDENTIFIED BY HESLO;

-- LOGIN - priezvisko
-- HESLO - krstne meno

SELECT
  'create user '|| PRIEZVISKO || ' identified by ' || MENO
FROM
  OS_UDAJE;

CREATE USER NOVAK IDENTIFIED BY Peter;

DROP USER NOVAK;

SELECT
  TABLE_NAME
FROM
  TABS;

ALTER TABLE NAZOV_TAB RENAME TO NOVY_NAZOV;

SELECT
  'alter table '||TABLE_NAME ||' rename to '|| 'tab'||TABLE_NAME
FROM
  TABS;

BEGIN
  FOR PREMENNA IN (
    SELECT
      'alter table '||TABLE_NAME ||' rename to '|| 'tab'||TABLE_NAME PRIKAZ
    FROM
      TABS
  ) LOOP
    EXECUTE IMMEDIATE PREMENNA.PRIKAZ;
  END LOOP;
END;
/

BEGIN
  FOR PREMENNA IN (
    SELECT
      'alter table '||TABLE_NAME ||' rename to '|| SUBSTR(TABLE_NAME,
      4) PRIKAZ
    FROM
      TABS
  ) LOOP
    EXECUTE IMMEDIATE PREMENNA.PRIKAZ;
  END LOOP;
END;
/

SELECT
  TABLE_NAME
FROM
  TABS;

SELECT
  MENO,
  PRIEZVISKO,
  CURSOR(
  SELECT
    OS_CISLO
  FROM
    STUDENT
  WHERE
    OS_UDAJE.ROD_CISLO=STUDENT.ROD_CISLO)
  FROM
    OS_UDAJE;

SELECT
  MENO,
  PRIEZVISKO,
  LISTAGG(OS_CISLO,
  ' ') WITHIN GROUP (
ORDER BY
  OS_CISLO)
FROM
  OS_UDAJE
  LEFT JOIN STUDENT
  USING(ROD_CISLO)
GROUP BY
  MENO,
  PRIEZVISKO,
  ROD_CISLO;